{"ast":null,"code":"import _toConsumableArray from\"C:\\\\dev\\\\mesto-react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"C:\\\\dev\\\\mesto-react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React from'react';import'../index.css';import Header from\"./Header\";import Main from\"./Main\";import Footer from\"./Footer\";import Login from\"./Login\";import ImagePopup from\"./ImagePopup\";import EditProfilePopup from\"./EditProfilePopup\";import EditAvatarPopup from\"./EditAvatarPopup\";import{api}from\"../utils/Api\";import{CurrentUserContext}from\"../contexts/CurrentUserContext\";import AddPlacePopup from\"./AddPlacePopup\";import{Route,Switch,withRouter,useHistory}from'react-router-dom';import ProtectedRoute from\"./ProtectedRoute\";import Register from\"./Register\";import InfoTooltip from\"./InfoTooltip\";import{HeaderContext,headers}from\"../contexts/HeaderContext\";import{InfoTooltipContext,infoTooltipCaptions}from\"../contexts/infoTooltipContext\";import{auth}from\"../utils/Auth\";function App(){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isEditProfilePopupOpen=_React$useState2[0],setIsEditProfilePopupOpen=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isAddPlacePopupOpen=_React$useState4[0],setIsAddPlacePopupOpen=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isEditAvatarPopupOpen=_React$useState6[0],setIsEditAvatarPopupOpen=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),isImagePopupOpen=_React$useState8[0],setIsImagePopupOpen=_React$useState8[1];var _React$useState9=React.useState(false),_React$useState10=_slicedToArray(_React$useState9,2),isInfoTooltipOpen=_React$useState10[0],setIsInfoTooltipOpen=_React$useState10[1];var _React$useState11=React.useState({}),_React$useState12=_slicedToArray(_React$useState11,2),selectedCard=_React$useState12[0],setSelectedCard=_React$useState12[1];var _React$useState13=React.useState({}),_React$useState14=_slicedToArray(_React$useState13,2),currentUser=_React$useState14[0],setCurrentUser=_React$useState14[1];var _React$useState15=React.useState(false),_React$useState16=_slicedToArray(_React$useState15,2),loggedIn=_React$useState16[0],setLoggedIn=_React$useState16[1];var _React$useState17=React.useState('login'),_React$useState18=_slicedToArray(_React$useState17,2),headerContext=_React$useState18[0],setHeaderContext=_React$useState18[1];var _React$useState19=React.useState('fail'),_React$useState20=_slicedToArray(_React$useState19,2),infoTooltipContext=_React$useState20[0],setInfoTooltipContext=_React$useState20[1];var _React$useState21=React.useState(''),_React$useState22=_slicedToArray(_React$useState21,2),email=_React$useState22[0],setEmail=_React$useState22[1];var history=useHistory();React.useEffect(function(){api.getUserInfo().then(function(res){setCurrentUser(res);}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err));});},[]);function overlayCloseEffect(popupName){function handleOverlayClose(evt){if(evt.target.classList.contains('popup_opened')){closeAllPopups();}}document.getElementById(\"popup__\".concat(popupName)).addEventListener('click',handleOverlayClose);return function(){document.getElementById(\"popup__\".concat(popupName)).removeEventListener('click',handleOverlayClose);};}function handleEditAvatarClick(){setIsEditAvatarPopupOpen(true);}function handleEditProfileClick(){setIsEditProfilePopupOpen(true);}function handleAddPlaceClick(){setIsAddPlacePopupOpen(true);}function handleCardClick(card){setIsImagePopupOpen(true);setSelectedCard(card);}function handleInfoTooltipOpen(){setIsInfoTooltipOpen(true);}function closeAllPopups(){setIsEditAvatarPopupOpen(false);setIsEditProfilePopupOpen(false);setIsAddPlacePopupOpen(false);setIsImagePopupOpen(false);setIsInfoTooltipOpen(false);setSelectedCard({});}function handleUpdateUser(newUserInfo){api.setNewUserInfo(newUserInfo).then(function(data){setCurrentUser(data);closeAllPopups();}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err));});}function handleUpdateAvatar(_ref){var avatar=_ref.avatar;api.setNewAvatar({avatar:avatar}).then(function(data){setCurrentUser(data);closeAllPopups();}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err));});}var _React$useState23=React.useState([]),_React$useState24=_slicedToArray(_React$useState23,2),cards=_React$useState24[0],setCards=_React$useState24[1];React.useEffect(function(){api.getInitialCards().then(function(res){setCards(res);}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err));});},[]);React.useEffect(function(){function tokenCheck(){var jwt=localStorage.getItem('token');if(jwt){auth.getContent(jwt).then(function(res){if(res){handleLogin();setEmail(res.data.email);history.push('/');}}).catch(function(err){return console.log(err);});}}tokenCheck();},[loggedIn,history]);function handleCardLike(card){var isLiked=card.likes.some(function(i){return i._id===currentUser._id;});(isLiked?api.dislike(card._id):api.like(card._id)).then(function(likedCard){var newCards=cards.map(function(currentCard){return currentCard._id===card._id?likedCard:currentCard;});setCards(newCards);}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err));});}function handleCardDelete(card){api.delete(card._id).then(function(){var newCards=cards.filter(function(currentCard){return currentCard._id!==card._id;});setCards(newCards);}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err));});}function handleAddPlaceSubmit(newCardInfo){api.addNewCard(newCardInfo).then(function(newCard){setCards([newCard].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err));});}function handleLogin(){setLoggedIn(true);}function handleLogout(){setLoggedIn(false);}function handleBtnSignOut(){handleLogout();localStorage.removeItem('token');history.push('/signin');}function handleLoginFormSubmit(password,email){auth.singIn(password,email).then(function(data){if(data.token){handleLogin();history.push('/');}}).catch(function(){setInfoTooltipContext('fail');handleInfoTooltipOpen();});}function handleRegisterFormSubmit(password,email){auth.register(password,email).then(function(res){if(res){setInfoTooltipContext('success');history.push('/signin');}else{setInfoTooltipContext('fail');}}).catch(function(err){return console.log(err);}).finally(function(){handleInfoTooltipOpen();});}return/*#__PURE__*/React.createElement(CurrentUserContext.Provider,{value:currentUser},/*#__PURE__*/React.createElement(\"div\",{className:\"page\"},/*#__PURE__*/React.createElement(\"div\",{className:\"content\"},/*#__PURE__*/React.createElement(HeaderContext.Provider,{value:headers[headerContext]},/*#__PURE__*/React.createElement(Header,{loggedIn:loggedIn,email:email,onSignOut:handleBtnSignOut,onHeaderChange:setHeaderContext})),/*#__PURE__*/React.createElement(Switch,null,/*#__PURE__*/React.createElement(Route,{path:\"/signup\"},/*#__PURE__*/React.createElement(Register,{onHeaderChange:setHeaderContext,onSubmit:handleRegisterFormSubmit})),/*#__PURE__*/React.createElement(Route,{path:\"/signin\"},/*#__PURE__*/React.createElement(Login,{onHeaderChange:setHeaderContext,onSubmit:handleLoginFormSubmit})),/*#__PURE__*/React.createElement(ProtectedRoute,{path:\"/\",loggedIn:loggedIn,component:Main,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onEditAvatar:handleEditAvatarClick,onCardClick:handleCardClick,cards:cards,onCardLike:handleCardLike,onCardDelete:handleCardDelete})),loggedIn&&/*#__PURE__*/React.createElement(Footer,null),/*#__PURE__*/React.createElement(InfoTooltipContext.Provider,{value:infoTooltipCaptions[infoTooltipContext]},/*#__PURE__*/React.createElement(InfoTooltip,{isOpen:isInfoTooltipOpen,onClose:closeAllPopups,loggedIn:loggedIn,overlayCloseEffect:overlayCloseEffect})),/*#__PURE__*/React.createElement(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser,overlayCloseEffect:overlayCloseEffect}),/*#__PURE__*/React.createElement(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit,overlayCloseEffect:overlayCloseEffect}),/*#__PURE__*/React.createElement(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onAvatarUpdate:handleUpdateAvatar,overlayCloseEffect:overlayCloseEffect}),/*#__PURE__*/React.createElement(ImagePopup,{isOpen:isImagePopupOpen,onClose:closeAllPopups,card:selectedCard,overlayCloseEffect:overlayCloseEffect}))));}export default withRouter(App);","map":{"version":3,"sources":["C:/dev/mesto-react/src/components/App.js"],"names":["React","Header","Main","Footer","Login","ImagePopup","EditProfilePopup","EditAvatarPopup","api","CurrentUserContext","AddPlacePopup","Route","Switch","withRouter","useHistory","ProtectedRoute","Register","InfoTooltip","HeaderContext","headers","InfoTooltipContext","infoTooltipCaptions","auth","App","useState","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isImagePopupOpen","setIsImagePopupOpen","isInfoTooltipOpen","setIsInfoTooltipOpen","selectedCard","setSelectedCard","currentUser","setCurrentUser","loggedIn","setLoggedIn","headerContext","setHeaderContext","infoTooltipContext","setInfoTooltipContext","email","setEmail","history","useEffect","getUserInfo","then","res","catch","err","console","log","overlayCloseEffect","popupName","handleOverlayClose","evt","target","classList","contains","closeAllPopups","document","getElementById","addEventListener","removeEventListener","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleCardClick","card","handleInfoTooltipOpen","handleUpdateUser","newUserInfo","setNewUserInfo","data","handleUpdateAvatar","avatar","setNewAvatar","cards","setCards","getInitialCards","tokenCheck","jwt","localStorage","getItem","getContent","handleLogin","push","handleCardLike","isLiked","likes","some","i","_id","dislike","like","likedCard","newCards","map","currentCard","handleCardDelete","delete","filter","handleAddPlaceSubmit","newCardInfo","addNewCard","newCard","handleLogout","handleBtnSignOut","removeItem","handleLoginFormSubmit","password","singIn","token","handleRegisterFormSubmit","register","finally"],"mappings":"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","sourcesContent":["import React from 'react';\nimport '../index.css';\nimport Header from \"./Header\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport Login from \"./Login\";\nimport ImagePopup from \"./ImagePopup\";\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport { api } from \"../utils/Api\";\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport { Route, Switch, withRouter, useHistory } from 'react-router-dom';\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport Register from \"./Register\";\nimport InfoTooltip from \"./InfoTooltip\";\nimport { HeaderContext, headers } from \"../contexts/HeaderContext\";\nimport { InfoTooltipContext, infoTooltipCaptions } from \"../contexts/infoTooltipContext\";\nimport { auth } from \"../utils/Auth\";\n\nfunction App() {\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = React.useState(false);\n  const [isImagePopupOpen, setIsImagePopupOpen] = React.useState(false);\n  const [isInfoTooltipOpen, setIsInfoTooltipOpen] = React.useState(false);\n  const [selectedCard, setSelectedCard] = React.useState({});\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [loggedIn, setLoggedIn] = React.useState(false);\n  const [headerContext, setHeaderContext] = React.useState('login');\n  const [infoTooltipContext, setInfoTooltipContext] = React.useState('fail');\n  const [email, setEmail] = React.useState('');\n\n  const history = useHistory();\n\n  React.useEffect(() => {\n    api.getUserInfo()\n      .then(res => {\n        setCurrentUser(res);\n      })\n      .catch(err => {\n        console.log(`Ошибка: ${err}`);\n      })\n  }, [])\n\n  function overlayCloseEffect(popupName) {\n    function handleOverlayClose(evt) {\n      if (evt.target.classList.contains('popup_opened')) {\n        closeAllPopups();\n      }\n    }\n\n    document\n      .getElementById(`popup__${popupName}`)\n      .addEventListener('click', handleOverlayClose)\n\n    return() => {\n      document\n        .getElementById(`popup__${popupName}`)\n        .removeEventListener('click', handleOverlayClose)\n    }\n  }\n\n  function handleEditAvatarClick() {\n    setIsEditAvatarPopupOpen(true);\n  }\n\n  function handleEditProfileClick() {\n    setIsEditProfilePopupOpen(true);\n  }\n\n  function handleAddPlaceClick() {\n    setIsAddPlacePopupOpen(true);\n  }\n\n  function handleCardClick(card) {\n    setIsImagePopupOpen(true);\n    setSelectedCard(card);\n  }\n\n  function handleInfoTooltipOpen() {\n    setIsInfoTooltipOpen(true);\n  }\n\n  function closeAllPopups() {\n    setIsEditAvatarPopupOpen(false);\n    setIsEditProfilePopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setIsImagePopupOpen(false);\n    setIsInfoTooltipOpen(false);\n    setSelectedCard({});\n  }\n\n  function handleUpdateUser(newUserInfo) {\n    api.setNewUserInfo(newUserInfo)\n      .then((data) => {\n        setCurrentUser(data);\n        closeAllPopups();\n      })\n      .catch(err => {\n        console.log(`Ошибка: ${err}`)\n      });\n  }\n\n  function handleUpdateAvatar({avatar}) {\n    api.setNewAvatar({avatar})\n      .then((data) => {\n        setCurrentUser(data);\n        closeAllPopups();\n      })\n      .catch(err => {\n        console.log(`Ошибка: ${err}`)\n      });\n  }\n\n  const [cards, setCards] = React.useState([]);\n\n  React.useEffect(() => {\n    api.getInitialCards()\n      .then(res => {\n        setCards(res);\n      })\n      .catch(err => {\n        console.log(`Ошибка: ${err}`)\n      });\n  }, [])\n\n  React.useEffect(() => {\n    function tokenCheck() {\n      const jwt = localStorage.getItem('token');\n      if (jwt) {\n        auth.getContent(jwt)\n          .then(res => {\n            if (res) {\n              handleLogin();\n              setEmail(res.data.email);\n              history.push('/');\n            }\n          })\n          .catch(err => console.log(err))\n      }\n    }\n\n      tokenCheck();\n  }, [loggedIn, history])\n\n\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n    (isLiked ? api.dislike(card._id) : api.like(card._id))\n      .then((likedCard) => {\n        const newCards = cards.map((currentCard) =>\n          currentCard._id === card._id ? likedCard : currentCard\n        );\n        setCards(newCards);\n      })\n      .catch(err => {\n        console.log(`Ошибка: ${err}`)\n      });\n  }\n\n  function handleCardDelete(card) {\n    api.delete(card._id)\n      .then(() => {\n        const newCards = cards.filter(currentCard =>\n          currentCard._id !== card._id\n        );\n        setCards(newCards);\n      })\n      .catch(err => {\n        console.log(`Ошибка: ${err}`)\n      });\n  }\n\n  function handleAddPlaceSubmit(newCardInfo) {\n    api.addNewCard(newCardInfo)\n      .then((newCard) => {\n        setCards([newCard, ...cards]);\n        closeAllPopups();\n      })\n      .catch(err => {\n        console.log(`Ошибка: ${err}`)\n      });\n  }\n\n  function handleLogin() {\n    setLoggedIn(true);\n  }\n\n  function handleLogout() {\n    setLoggedIn(false);\n  }\n\n  function handleBtnSignOut() {\n    handleLogout();\n    localStorage.removeItem('token');\n    history.push('/signin');\n  }\n\n  function handleLoginFormSubmit(password, email) {\n    auth.singIn(password, email)\n      .then(data => {\n        if (data.token) {\n          handleLogin();\n          history.push('/');\n        }\n      })\n      .catch(() => {\n        setInfoTooltipContext('fail');\n        handleInfoTooltipOpen();\n      })\n  }\n\n  function handleRegisterFormSubmit(password, email) {\n    auth.register(password, email)\n      .then(res => {\n        if (res) {\n          setInfoTooltipContext('success');\n          history.push('/signin');\n        } else {\n          setInfoTooltipContext('fail');\n        }\n      })\n      .catch(err => console.log(err))\n      .finally(() => {\n        handleInfoTooltipOpen();\n      })\n  }\n\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n      <div className=\"page\">\n        <div className=\"content\">\n          <HeaderContext.Provider value={headers[headerContext]}>\n            <Header loggedIn={loggedIn}\n                    email={email}\n                    onSignOut={handleBtnSignOut}\n                    onHeaderChange={setHeaderContext}\n            />\n          </HeaderContext.Provider>\n\n          <Switch>\n            <Route path=\"/signup\">\n              <Register onHeaderChange={setHeaderContext}\n                        onSubmit={handleRegisterFormSubmit}\n              />\n            </Route>\n\n            <Route path=\"/signin\">\n              <Login onHeaderChange={setHeaderContext}\n                     onSubmit={handleLoginFormSubmit}\n              />\n            </Route>\n\n            <ProtectedRoute path=\"/\"\n                            loggedIn={loggedIn}\n                            component={Main}\n                            onEditProfile={handleEditProfileClick}\n                            onAddPlace={handleAddPlaceClick}\n                            onEditAvatar={handleEditAvatarClick}\n                            onCardClick={handleCardClick}\n                            cards={cards}\n                            onCardLike={handleCardLike}\n                            onCardDelete={handleCardDelete}\n            />\n          </Switch>\n\n          {loggedIn && <Footer/>}\n\n          <InfoTooltipContext.Provider value={infoTooltipCaptions[infoTooltipContext]}>\n            <InfoTooltip\n              isOpen={isInfoTooltipOpen}\n              onClose={closeAllPopups}\n              loggedIn={loggedIn}\n              overlayCloseEffect={overlayCloseEffect}\n            />\n          </InfoTooltipContext.Provider>\n\n          <EditProfilePopup\n            isOpen={isEditProfilePopupOpen}\n            onClose={closeAllPopups}\n            onUpdateUser={handleUpdateUser}\n            overlayCloseEffect={overlayCloseEffect}\n          />\n\n          <AddPlacePopup\n            isOpen={isAddPlacePopupOpen}\n            onClose={closeAllPopups}\n            onAddPlace={handleAddPlaceSubmit}\n            overlayCloseEffect={overlayCloseEffect}\n          />\n\n          <EditAvatarPopup\n            isOpen={isEditAvatarPopupOpen}\n            onClose={closeAllPopups}\n            onAvatarUpdate={handleUpdateAvatar}\n            overlayCloseEffect={overlayCloseEffect}\n          />\n\n          <ImagePopup\n            isOpen={isImagePopupOpen}\n            onClose={closeAllPopups}\n            card={selectedCard}\n            overlayCloseEffect={overlayCloseEffect}\n          />\n        </div>\n      </div>\n    </CurrentUserContext.Provider>\n  );\n}\n\nexport default withRouter(App);\n"]},"metadata":{},"sourceType":"module"}