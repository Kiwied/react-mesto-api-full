{"ast":null,"code":"import _toConsumableArray from\"C:\\\\dev\\\\mesto-react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"C:\\\\dev\\\\mesto-react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React from'react';import'../index.css';import Header from\"./Header\";import Main from\"./Main\";import Footer from\"./Footer\";import Login from\"./Login\";import PopupWithForm from\"./PopupWithForm\";import ImagePopup from\"./ImagePopup\";import EditProfilePopup from\"./EditProfilePopup\";import EditAvatarPopup from\"./EditAvatarPopup\";import{api}from\"../utils/Api\";import{CurrentUserContext}from\"../contexts/CurrentUserContext\";import AddPlacePopup from\"./AddPlacePopup\";import{Route,Switch,withRouter,useHistory}from'react-router-dom';import ProtectedRoute from\"./ProtectedRoute\";import Register from\"./Register\";import InfoTooltip from\"./InfoTooltip\";import{HeaderContext,headers}from\"../contexts/HeaderContext\";import{InfoTooltipContext,infoTooltipCaptions}from\"../contexts/infoTooltipContext\";import{auth}from\"../utils/Auth\";function App(){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isEditProfilePopupOpen=_React$useState2[0],setIsEditProfilePopupOpen=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isAddPlacePopupOpen=_React$useState4[0],setIsAddPlacePopupOpen=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isEditAvatarPopupOpen=_React$useState6[0],setIsEditAvatarPopupOpen=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),isImagePopupOpen=_React$useState8[0],setIsImagePopupOpen=_React$useState8[1];var _React$useState9=React.useState(false),_React$useState10=_slicedToArray(_React$useState9,2),isInfoTooltipOpen=_React$useState10[0],setIsInfoTooltipOpen=_React$useState10[1];var _React$useState11=React.useState({}),_React$useState12=_slicedToArray(_React$useState11,2),selectedCard=_React$useState12[0],setSelectedCard=_React$useState12[1];var _React$useState13=React.useState({}),_React$useState14=_slicedToArray(_React$useState13,2),currentUser=_React$useState14[0],setCurrentUser=_React$useState14[1];var _React$useState15=React.useState(false),_React$useState16=_slicedToArray(_React$useState15,2),loggedIn=_React$useState16[0],setLoggedIn=_React$useState16[1];var _React$useState17=React.useState('login'),_React$useState18=_slicedToArray(_React$useState17,2),headerContext=_React$useState18[0],setHeaderContext=_React$useState18[1];var _React$useState19=React.useState('fail'),_React$useState20=_slicedToArray(_React$useState19,2),infoTooltipContext=_React$useState20[0],setInfoTooltipContext=_React$useState20[1];var _React$useState21=React.useState(''),_React$useState22=_slicedToArray(_React$useState21,2),email=_React$useState22[0],setEmail=_React$useState22[1];var history=useHistory();React.useEffect(function(){api.getUserInfo().then(function(res){setCurrentUser(res);}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err));});},[]);function handleEditAvatarClick(){setIsEditAvatarPopupOpen(true);}function handleEditProfileClick(){setIsEditProfilePopupOpen(true);}function handleAddPlaceClick(){setIsAddPlacePopupOpen(true);}function handleCardClick(card){setIsImagePopupOpen(true);setSelectedCard(card);}function handleInfoTooltipOpen(){setIsInfoTooltipOpen(true);}function closeAllPopups(){setIsEditAvatarPopupOpen(false);setIsEditProfilePopupOpen(false);setIsAddPlacePopupOpen(false);setIsImagePopupOpen(false);setIsInfoTooltipOpen(false);setSelectedCard({});}function handleUpdateUser(newUserInfo){api.setNewUserInfo(newUserInfo).then(function(data){setCurrentUser(data);closeAllPopups();}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err));});}function handleUpdateAvatar(_ref){var avatar=_ref.avatar;api.setNewAvatar({avatar:avatar}).then(function(data){setCurrentUser(data);closeAllPopups();}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err));});}var _React$useState23=React.useState([]),_React$useState24=_slicedToArray(_React$useState23,2),cards=_React$useState24[0],setCards=_React$useState24[1];React.useEffect(function(){api.getInitialCards().then(function(res){setCards(res);}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err));});},[]);React.useEffect(function(){tokenCheck();},[loggedIn]);function tokenCheck(){var jwt=localStorage.getItem('token');if(jwt){auth.getContent(jwt).then(function(res){if(res){handleLogin();setEmail(res.data.email);history.push('/');}});}}function handleCardLike(card){var isLiked=card.likes.some(function(i){return i._id===currentUser._id;});(isLiked?api.dislike(card._id):api.like(card._id)).then(function(likedCard){var newCards=cards.map(function(currentCard){return currentCard._id===card._id?likedCard:currentCard;});setCards(newCards);}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err));});}function handleCardDelete(card){api.delete(card._id).then(function(){var newCards=cards.filter(function(currentCard){return currentCard._id!==card._id;});setCards(newCards);}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err));});}function handleAddPlaceSubmit(newCardInfo){api.addNewCard(newCardInfo).then(function(newCard){setCards([newCard].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err));});}function handleLogin(){setLoggedIn(true);}function handleLogout(){setLoggedIn(false);}return/*#__PURE__*/React.createElement(CurrentUserContext.Provider,{value:currentUser},/*#__PURE__*/React.createElement(\"div\",{className:\"page\"},/*#__PURE__*/React.createElement(\"div\",{className:\"content\"},/*#__PURE__*/React.createElement(HeaderContext.Provider,{value:headers[headerContext]},/*#__PURE__*/React.createElement(Header,{loggedIn:loggedIn,email:email,onSignOut:handleLogout,onHeaderChange:setHeaderContext})),/*#__PURE__*/React.createElement(Switch,null,/*#__PURE__*/React.createElement(Route,{path:\"/signup\"},/*#__PURE__*/React.createElement(Register,{onHeaderChange:setHeaderContext,onSubmit:handleInfoTooltipOpen,onSigning:setInfoTooltipContext})),/*#__PURE__*/React.createElement(Route,{path:\"/signin\"},/*#__PURE__*/React.createElement(Login,{onHeaderChange:setHeaderContext,handleLogin:handleLogin,onLogout:handleLogout,onError:handleInfoTooltipOpen})),/*#__PURE__*/React.createElement(ProtectedRoute,{exact:true,path:\"/\",loggedIn:loggedIn,component:Main,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onEditAvatar:handleEditAvatarClick,onCardClick:handleCardClick,cards:cards,onCardLike:handleCardLike,onCardDelete:handleCardDelete})),loggedIn&&/*#__PURE__*/React.createElement(Footer,null),/*#__PURE__*/React.createElement(InfoTooltipContext.Provider,{value:infoTooltipCaptions[infoTooltipContext]},/*#__PURE__*/React.createElement(InfoTooltip,{isOpen:isInfoTooltipOpen,onClose:closeAllPopups,loggedIn:loggedIn,name:\"infoTooltip\"})),/*#__PURE__*/React.createElement(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser}),/*#__PURE__*/React.createElement(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit}),/*#__PURE__*/React.createElement(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onAvatarUpdate:handleUpdateAvatar}),/*#__PURE__*/React.createElement(PopupWithForm,{name:\"delete\",title:\"\\u0412\\u044B \\u0443\\u0432\\u0435\\u0440\\u0435\\u043D\\u044B?\",button:\"\\u0414\\u0430\"}),/*#__PURE__*/React.createElement(ImagePopup,{isOpen:isImagePopupOpen,onClose:closeAllPopups,card:selectedCard}))));}export default withRouter(App);","map":{"version":3,"sources":["C:/dev/mesto-react/src/components/App.js"],"names":["React","Header","Main","Footer","Login","PopupWithForm","ImagePopup","EditProfilePopup","EditAvatarPopup","api","CurrentUserContext","AddPlacePopup","Route","Switch","withRouter","useHistory","ProtectedRoute","Register","InfoTooltip","HeaderContext","headers","InfoTooltipContext","infoTooltipCaptions","auth","App","useState","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isImagePopupOpen","setIsImagePopupOpen","isInfoTooltipOpen","setIsInfoTooltipOpen","selectedCard","setSelectedCard","currentUser","setCurrentUser","loggedIn","setLoggedIn","headerContext","setHeaderContext","infoTooltipContext","setInfoTooltipContext","email","setEmail","history","useEffect","getUserInfo","then","res","catch","err","console","log","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleCardClick","card","handleInfoTooltipOpen","closeAllPopups","handleUpdateUser","newUserInfo","setNewUserInfo","data","handleUpdateAvatar","avatar","setNewAvatar","cards","setCards","getInitialCards","tokenCheck","jwt","localStorage","getItem","getContent","handleLogin","push","handleCardLike","isLiked","likes","some","i","_id","dislike","like","likedCard","newCards","map","currentCard","handleCardDelete","delete","filter","handleAddPlaceSubmit","newCardInfo","addNewCard","newCard","handleLogout"],"mappings":"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","sourcesContent":["import React from 'react';\nimport '../index.css';\nimport Header from \"./Header\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport Login from \"./Login\";\nimport PopupWithForm from \"./PopupWithForm\";\nimport ImagePopup from \"./ImagePopup\";\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport { api } from \"../utils/Api\";\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport { Route, Switch, withRouter, useHistory } from 'react-router-dom';\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport Register from \"./Register\";\nimport InfoTooltip from \"./InfoTooltip\";\nimport { HeaderContext, headers } from \"../contexts/HeaderContext\";\nimport { InfoTooltipContext, infoTooltipCaptions } from \"../contexts/infoTooltipContext\";\nimport { auth } from \"../utils/Auth\";\n\nfunction App() {\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = React.useState(false);\n  const [isImagePopupOpen, setIsImagePopupOpen] = React.useState(false);\n  const [isInfoTooltipOpen, setIsInfoTooltipOpen] = React.useState(false);\n  const [selectedCard, setSelectedCard] = React.useState({});\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [loggedIn, setLoggedIn] = React.useState(false);\n  const [headerContext, setHeaderContext] = React.useState('login');\n  const [infoTooltipContext, setInfoTooltipContext] = React.useState('fail');\n  const [email, setEmail] = React.useState('');\n\n  const history = useHistory();\n\n  React.useEffect(() => {\n    api.getUserInfo()\n      .then(res => {\n        setCurrentUser(res);\n      })\n      .catch(err => {\n        console.log(`Ошибка: ${err}`);\n      })\n  }, [])\n\n\n  function handleEditAvatarClick() {\n    setIsEditAvatarPopupOpen(true);\n  }\n\n  function handleEditProfileClick() {\n    setIsEditProfilePopupOpen(true);\n  }\n\n  function handleAddPlaceClick() {\n    setIsAddPlacePopupOpen(true);\n  }\n\n  function handleCardClick(card) {\n    setIsImagePopupOpen(true);\n    setSelectedCard(card);\n  }\n\n  function handleInfoTooltipOpen() {\n    setIsInfoTooltipOpen(true);\n  }\n\n  function closeAllPopups() {\n    setIsEditAvatarPopupOpen(false);\n    setIsEditProfilePopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setIsImagePopupOpen(false);\n    setIsInfoTooltipOpen(false);\n    setSelectedCard({});\n  }\n\n  function handleUpdateUser(newUserInfo) {\n    api.setNewUserInfo(newUserInfo)\n      .then((data) => {\n        setCurrentUser(data);\n        closeAllPopups();\n      })\n      .catch(err => {\n        console.log(`Ошибка: ${err}`)\n      });\n  }\n\n  function handleUpdateAvatar({avatar}) {\n    api.setNewAvatar({avatar})\n      .then((data) => {\n        setCurrentUser(data);\n        closeAllPopups();\n      })\n      .catch(err => {\n        console.log(`Ошибка: ${err}`)\n      });\n  }\n\n  const [cards, setCards] = React.useState([]);\n\n  React.useEffect(() => {\n    api.getInitialCards()\n      .then(res => {\n        setCards(res);\n      })\n      .catch(err => {\n        console.log(`Ошибка: ${err}`)\n      });\n  }, [])\n\n  React.useEffect(() => {\n      tokenCheck();\n  }, [loggedIn])\n\n  function tokenCheck() {\n    const jwt = localStorage.getItem('token');\n    if (jwt) {\n      auth.getContent(jwt)\n        .then(res => {\n          if (res) {\n            handleLogin();\n            setEmail(res.data.email);\n            history.push('/');\n          }\n        })\n    }\n  }\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n    (isLiked ? api.dislike(card._id) : api.like(card._id))\n      .then((likedCard) => {\n        const newCards = cards.map((currentCard) =>\n          currentCard._id === card._id ? likedCard : currentCard\n        );\n        setCards(newCards);\n      })\n      .catch(err => {\n        console.log(`Ошибка: ${err}`)\n      });\n  }\n\n  function handleCardDelete(card) {\n    api.delete(card._id)\n      .then(() => {\n        const newCards = cards.filter(currentCard =>\n          currentCard._id !== card._id\n        );\n        setCards(newCards);\n      })\n      .catch(err => {\n        console.log(`Ошибка: ${err}`)\n      });\n  }\n\n  function handleAddPlaceSubmit(newCardInfo) {\n    api.addNewCard(newCardInfo)\n      .then((newCard) => {\n        setCards([newCard, ...cards]);\n        closeAllPopups();\n      })\n      .catch(err => {\n        console.log(`Ошибка: ${err}`)\n      });\n  }\n\n  function handleLogin() {\n    setLoggedIn(true);\n  }\n\n  function handleLogout() {\n    setLoggedIn(false);\n  }\n\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n      <div className=\"page\">\n        <div className=\"content\">\n          <HeaderContext.Provider value={headers[headerContext]}>\n            <Header loggedIn={loggedIn}\n                    email={email}\n                    onSignOut={handleLogout}\n                    onHeaderChange={setHeaderContext}\n            />\n          </HeaderContext.Provider>\n\n          <Switch>\n            <Route path=\"/signup\">\n              <Register onHeaderChange={setHeaderContext}\n                        onSubmit={handleInfoTooltipOpen}\n                        onSigning={setInfoTooltipContext}\n              />\n            </Route>\n\n            <Route path=\"/signin\">\n              <Login onHeaderChange={setHeaderContext}\n                     handleLogin={handleLogin}\n                     onLogout={handleLogout}\n                     onError={handleInfoTooltipOpen}\n              />\n            </Route>\n\n            <ProtectedRoute exact path=\"/\"\n                            loggedIn={loggedIn}\n                            component={Main}\n                            onEditProfile={handleEditProfileClick}\n                            onAddPlace={handleAddPlaceClick}\n                            onEditAvatar={handleEditAvatarClick}\n                            onCardClick={handleCardClick}\n                            cards={cards}\n                            onCardLike={handleCardLike}\n                            onCardDelete={handleCardDelete}\n            >\n            </ProtectedRoute>\n          </Switch>\n\n          {loggedIn && <Footer/>}\n\n          <InfoTooltipContext.Provider value={infoTooltipCaptions[infoTooltipContext]}>\n            <InfoTooltip\n              isOpen={isInfoTooltipOpen}\n              onClose={closeAllPopups}\n              loggedIn={loggedIn}\n              name=\"infoTooltip\"\n            />\n          </InfoTooltipContext.Provider>\n\n          <EditProfilePopup\n            isOpen={isEditProfilePopupOpen}\n            onClose={closeAllPopups}\n            onUpdateUser={handleUpdateUser}\n          />\n\n          <AddPlacePopup\n            isOpen={isAddPlacePopupOpen}\n            onClose={closeAllPopups}\n            onAddPlace={handleAddPlaceSubmit}\n          />\n\n          <EditAvatarPopup\n            isOpen={isEditAvatarPopupOpen}\n            onClose={closeAllPopups}\n            onAvatarUpdate={handleUpdateAvatar}\n          />\n\n          <PopupWithForm\n            name=\"delete\"\n            title=\"Вы уверены?\"\n            button=\"Да\"\n          />\n\n          <ImagePopup\n            isOpen={isImagePopupOpen}\n            onClose={closeAllPopups}\n            card={selectedCard}\n          />\n        </div>\n      </div>\n    </CurrentUserContext.Provider>\n  );\n}\n\nexport default withRouter(App);\n"]},"metadata":{},"sourceType":"module"}